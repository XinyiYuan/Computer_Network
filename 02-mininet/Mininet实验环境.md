<center><font size='60'><b> Mininet 实验环境 </b></font></center>

<center> 中国科学院大学 </center>

<center>袁欣怡 2018K8009929021</center>

<center>2021.3.22</center>



## 一、互联网协议实验

### 1. 实验内容

（1）搭建实验环境：安装wireshark，搭建mininet实验环境，连接互联网，配置dns

（2）使用wget获取根页面www.baidu.com

（3）观察wireshark的输出

### 2. 实验流程

（1）搭建实验环境

（2）获取根页面

（3）分析wireshark的输出

### 3. 实验结果和分析

（1）wireshark获得的抓包结果：

<img src="/Users/smx1228/Desktop/02/截屏2021-03-25 上午12.03.29.png" alt="截屏2021-03-25 上午12.03.29" style="zoom:15%;" />

​	从这里可以看出，整个过程中主要出现了四种协议：DNS、TCP、HTTP和ARP

（2）DNS协议

<img src="/Users/smx1228/Desktop/02/截屏2021-03-25 上午12.05.54.png" alt="截屏2021-03-25 上午12.05.54" style="zoom:15%;" />

​	全称位域名系统Domain Name System，主要作用是将域名和IP地址之间构造相互映射。当访问网址时需要知道他的IP，但是IP由数字构成，不方便记忆，因此我们需要域名（如www.baidu.com）作为IP的“别名”，来帮助我们记忆。域名和IP之间的对应关系就由DNS来确定。

​	在上图中，由本地IP地址10.0.0.1作为 `source` ，向目的地址1.2.4.8（DNS服务器IP）发送查询的请求，然后1.2.4.8返回给本地IP其解析结果。从上图中可以看出，解析的结果为180.101.49.12。

（3）TCP协议

​	传输控制协议Transmission Control Protocol，是一种面向连接的、可靠的、基于字节流的传输层通信协议。TCP是IP协议的上层协议，也是应用层协议的下层协议。我们已经知道IP协议是地址协议，但是IP协议没法保证传输过程中数据包的完整性，所以需要TCP协议处理丢包的情况。

​	上图展示了建立连接的过程：1.由客户端向服务端发送 `SYN` ；2.服务端向客户端发送 `SYN+ACK` 的响应报文；3.客户端向服务端发送 `ACK` 响应报文。通过三次握手建立一个完整的连接。其中`FIN`表示关闭连接， `PSH` 代表着存在数据传输。

（4）HTTP协议

<img src="/Users/smx1228/Desktop/02/截屏2021-03-25 上午12.06.36.png" alt="截屏2021-03-25 上午12.06.36" style="zoom:15%;" />

​	超文本传输协议Hyper Text Transfer Protocol，是基于TCP协议的应用层传输协议，简单来说就是客户端和服务端进行数据传输的一种规则。通常，由HTTP客户端发起一个请求，创建一个到服务器指定端口（默认是80端口）的TCP连接，然后HTTP服务器就可以在那个端口监听客户端的请求。一旦收到请求，服务器会向客户端返回一个状态以及返回的内容，如请求的文件、错误消息、或者其它信息。

因为我们进行了 `wget` 操作，所以上图中出现了 `GET` 请求，从指定资源请求数据。

（5）ARP协议

​	地址解析协议Address Resolution Protocol，是根据IP地址获取物理地址的一个TCP/IP协议。在OSI模型中，IP地址在第三层，MAC地址在第二层。通过以太网发送数据包时，只知道目标IP地址，不知道MAC地址，所以需要使用地址解析协议，根据网络层IP数据包包头中的IP地址信息解析出目标硬件地址（MAC地址）信息。

​	在上图中，ARP协议解析出10.0.0.1的MAC地址和10.0.0.3 的MAC地址。具体的步骤是：10.0.0.3发送广播，询问哪个MAC地址对应的IP为10.0.0.1，10.0.0.1在收到消息后回复10.0.0.3。

（6）不同协议之间的封装

​	从 `（2）DNS协议` 的配图中可以看出：Ethernet < IP < UDP < DNS；

​	从 `（4）HTTP协议` 的配图中可以看出：Ethernet < IP < TCP < HTTP。

​	从下图中可以看出，TCP承载HTTP协议。

<figure class="half"><center>
    <img src="/Users/smx1228/Desktop/02/截屏2021-03-25 上午12.07.45.png" alt="截屏2021-03-25 上午12.07.45" style="zoom:9%;" />
    <img src="/Users/smx1228/Desktop/02/截屏2021-03-25 上午12.07.56.png" alt="截屏2021-03-25 上午12.07.56" style="zoom:9%;" />
</center></figure>




## 二、流完成时间实验

### 1. 实验内容

分析传输不同大小的数据包所需要的时间与带宽之间的关系。

### 2. 实验流程

（1）编写脚本fct_exp.py

（2）在结点 `h2` 分配一个数据包空间，并在结点 `h1` 进行抓包，统计传输时间

（3）修改数据包大小、延迟和带宽等参数，再次统计传输时间

### 3. 实验结果和分析

（1）实验数据（五次实验取平均）：

| 时间t/s | 1MB  | 10MB | 100MB |
| :-----: | :--: | :--: | :---: |
| 10Mbps  | 1.5  | 9.4  |  88   |
| 50Mbps  | 1.2  | 2.9  |  19   |
| 100Mbps | 1.2  | 2.2  |  10   |
| 500Mbps | 1.2  | 2.0  |  4.3  |
|  1Gbps  | 1.2  | 1.95 |  4.3  |

（2）数据处理：

​	用花费时间的倒数来衡量传输文件的“速度”，做出时间与带宽的关系图像。

​	为了方便读图，横纵坐标均使用对数坐标系。具体来说，可以将纵坐标设置为 $ log_{10}{\frac{t_0}{t}}+1 $ ，其中 $ t_0 $ 为用10Mbps带宽传输当前文件所需要的时间，$ t $ 为用某带宽传输当前文件所需要的时间。将横坐标设置为 $ log_{10}{\frac{BS}{BS_0}} +1 $ ，其中 $BS_0$ 为10Mbps， $BS$ 为当前带宽。

​	可以做出下图：

<img src="/Users/smx1228/Desktop/02/图片 1.png" alt="图片 1" style="zoom:20%;" />

（3）数据分析：

​	理想情况下，趋势线应为一条斜率为1的直线。但是实际情况中发现：实际传输时间比预计时间长很多，且文件越小、带宽越大，拟合出的曲线离理想曲线越远。

​	通过查阅资料，我们不难发现，TCP 协议中利用了慢启动和拥塞避免机制，于是出现上面的现象。慢启动算法在主机刚开始发送数据报的时先探测网络的状况。如果网络状况良好，即发送方发送的报文段可以被接受，那么就加倍发送窗口的大小。因此上图中的增长是非线性的。另外拥塞窗口的大小不会无限制的增长下去，因此小数据包受慢启动机制影响会比大数据包更显著。



## 参考资料

1. Wireshark-DNS数据报分析：https://blog.csdn.net/ahafg/article/details/51035691?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&spm=1001.2101.3001.4242
2. 五分钟读懂TCP 协议——TCP协议简介：https://blog.csdn.net/ningdaxing1994/article/details/73076795
3. HTTP协议超级详解：https://www.cnblogs.com/an-wen/p/11180076.html
4. ARP百度百科：https://baike.baidu.com/item/ARP/609343
5. TCP-慢启动与拥塞避免：https://zhuanlan.zhihu.com/p/139378305

